{% extends "base.html" %}
{% block titleTag -%}
<title>{{ _("Feeds") }} - KindleEar</title>
{% endblock -%}

{% block bodytag -%}
<body class="my-rss">
{% endblock -%}

{% block content -%}
<div class="main">
  <legend><h3>{{_("Custom RSS")}}</legend>
  <div class="box-list">
    <div class="book box pure-form pure-form-aligned">
      <div class="pure-control-group titleRow pure-g">
        <div class="pure-u-3-5 pure-u-sm-3-4 pure-u-md-5-6">
          <input type="text" name="rss_title" id="title_to_add" class="pure-u-23-24 pure-input-rounded" placeholder="{{ _('Title')}}"
            {% if title_to_add %}value="{{title_to_add}}"{% endif %}/>
        </div>
        <div class="pure-u-2-5 pure-u-sm-1-4 pure-u-md-1-6">
          <div>
            <label style="white-space:nowrap;"><input type="checkbox" name="fulltext" id="isfulltext" />
            {{_("Content embedded")}}</label>
          </div>
        </div>
      </div>
      <div class="summaryRow">
        <input type="text" name="url" id="url_to_add" class="pure-input-1 pure-input-rounded" placeholder="URL"
        {% if url_to_add %}value="{{url_to_add}}"{% endif %}/>
      </div>
      <div class="cornerControls">
        <button onclick="AddCustomRss();return false;" class="actionButton add">{{_("Add")}}</button>
      </div>
      {% if tips -%}
        <div class="notice-box">{{tips|safe}}</div>
      {% endif -%}
    </div>

    <div id="divMyCustomRss">
      <!-- 由脚本在这里填充数据 -->
    </div>
  </div>
  
  <legend><h3>{{ _("Subscribed") }}</h3></legend>
  <div id="mysubscribed" class="box-list">
    <!-- 由脚本在这里填充数据 -->
  </div>

  <legend><h3>{{ _("Library") }} </h3></legend>
  <div class="pure-g box-list noborder">
    <div class="pure-u-1-3 width1_3 pure-form">
      <select class="pure-input-rounded width100" id="language_pick">
      </select>
    </div>
    <div class="pure-u-1-6">
      <div class="upload-recipe">
        <button class="upload-recipe-btn" title="{{_('Upload your custom recipe')}}"onclick="OpenUploadRecipeDialog()"><i class="iconfont icon-upload"></i></button>
      </div>
    </div>
    <div class="pure-u-3-6">
      <div class="pure-form">
        <input type="text" name="search" id="search_recipe" class="pure-input-rounded" placeholder="{{ _('Search')}}" />
      </div>
    </div>
  </div>
  <div id="all_recipes" class="box-list">
    <!-- 由脚本在这里填充数据 -->
  </div>
  <div id="toast" class="toast">
    <i>&#10003; {{_("Subscription to selected recipe successful.")}}</i>
  </div>

  <legend><h3>{{ _("Bookmarklet") }}</h3></legend>
  <div id="bookmarklet" class="box-list">
    <div class="book box" id="bookmarklet_content">
      <a class="actionButton" target="_blank" href="
javascript:void(open('{{url2book_url}}?userName={{user.name}}&subject='+encodeURIComponent(document.title)+'&urls='+encodeURIComponent(window.location.href)));" onclick="return false;">
        {{_("Send to Kindle")}}
      </a>
      <a class="actionButton" target="_blank" href="
javascript:void(open('{{subscribe_url}}?title_to_add='+encodeURIComponent(document.title)+'&url_to_add='+encodeURIComponent(window.location.href)));" onclick="return false;">
        {{_("Subscribe with KindleEar")}}
      </a>
      <div style="padding-top:10px;text-align:center;">
        <small>- {{_("Drag and drop this link to your bookmarks")}} -</small>
      </div>
    </div>

  </div>
</div>
{% endblock -%}

{% block javascript_inhead -%}
<script type="text/javascript">
var my_custom_rss_list = {{my_custom_rss|safe}};
var my_uploaded_recipes = {{my_uploaded_recipes|safe}};
var my_booked_recipes = {{my_booked_recipes|safe}};
var all_builtin_recipes = {};
</script>
{% endblock -%}

{% block js -%}
<script type="text/javascript">
$(document).ready(function() {
  FetchBuiltinRecipesXml();
  PopulateMyCustomRss(); //填充订阅区段
  PopulateMySubscribed();
  RegisterHideHambClick();
  //在界面上选择了一项Recipe语种，将对应语种的recipe显示出来
  $("#language_pick").on("change", function(){
    PopulateLibrary('');
  });

  //在指定语言里面搜索标题或描述
  $("#search_recipe").on("input", function() {
    PopulateLibrary($(this).val());
  });

  {% if session.get('role') != 'admin' -%}
  var mailPrefix = "{{user.name}}__";
  {% else -%}
  var mailPrefix = '';
  {% endif -%}
  insertBookmarkletGmailThis("{{subscribe_url}}", mailPrefix);
});
</script>
{% endblock -%}
